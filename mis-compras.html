<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mis Compras - MTA Market</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <button class="cat-btn" onclick="location.href='home.html'">‚Üê Volver</button>
        </div>
        <h2>Mis Mapeos</h2>
        <div id="compras-lista"></div>
    </div>
    <script src="script.js"></script>
    <script>
        window.onload = () => {
            const user = localStorage.getItem('usuario_logeado');
            const db = obtenerDB();
            const misMapeos = db.filter(m => m.comprador === user);
            const lista = document.getElementById('compras-lista');

            misMapeos.forEach(m => {
                lista.innerHTML += `
                    <div class="card" style="display:flex; padding:20px; gap:20px; background:#111; border: 1px solid #222;">
                        <img src="${m.img}" style="width:100px; height:80px; border-radius:5px;">
                        <div style="flex-grow:1;">
                            <h3>${m.nombre}</h3>
                            <p>Estado: ${m.comprado ? '<b style="color:lime;">APROBADO</b>' : '<b style="color:orange;">PENDIENTE</b>'}</p>
                            <p>IP: <b>${m.clienteIP || 'Sin vincular'}</b></p>
                            <input type="text" id="ip-${m.id}" placeholder="Vincular IP">
                            <button onclick="vincular(${m.id})">Vincular</button>
                        </div>
                    </div>`;
            });
        };
        function vincular(id) {
            const ip = document.getElementById('ip-' + id).value;
            let db = obtenerDB();
            const i = db.findIndex(x => x.id === id);
            db[i].clienteIP = ip;
            guardarDB(db);
            registrarLog('Vincular IP', localStorage.getItem('usuario_logeado'), `Mapeo: ${db[i].nombre}, IP: ${ip}`);
            location.reload();
        }
    </script>
</body>
</html>